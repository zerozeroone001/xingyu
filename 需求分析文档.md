# 诗词程序 - 需求分析文档

## 一、项目概述

### 1.1 项目定位
一个面向诗词爱好者的多端互动平台，集诗词欣赏、学习、社交于一体。

### 1.2 目标用户
- 诗词爱好者
- 传统文化学习者
- 文学创作者
- 诗词教育工作者

### 1.3 核心价值
- **内容丰富**：海量诗词资源，多维度检索
- **社交互动**：用户交流、飞花令游戏、内容分享
- **个性推荐**：智能推荐符合用户兴趣的诗词
- **多端同步**：小程序、H5网页无缝切换

---

## 二、系统架构

### 2.1 平台端
- **用户端 - 微信小程序**：主要使用场景，微信生态内使用
- **用户端 - H5网页**：跨平台访问，浏览器直接使用
- **管理端**：后台管理系统，内容审核与运营

### 2.2 技术架构建议

#### 前端技术栈
- **小程序端**：
  - 原生微信小程序开发（WXML + WXSS + JavaScript）
  - 或 uni-app（可同时编译为小程序和H5）
  - 或 Taro（React技术栈）

- **H5端**：
  - Vue 3 + Vite（推荐）
  - React + Next.js
  - 或与小程序共用 uni-app/Taro

- **管理端**：
  - Vue 3 + Element Plus / Ant Design Vue
  - React + Ant Design

#### 后端技术栈
- **开发语言**：
  - Node.js (Express/Koa/NestJS)
  - Python (Django/FastAPI)
  - Java (Spring Boot)
  - Go (Gin/Beego)

- **数据库**：
  - MySQL/PostgreSQL（关系型数据库，存储用户、诗词等结构化数据）
  - MongoDB（文档型数据库，灵活存储诗词内容）
  - Redis（缓存层，存储热点数据、排行榜等）

- **搜索引擎**：
  - Elasticsearch（全文搜索，诗词内容检索）

- **消息队列**：
  - RabbitMQ/Kafka（异步任务处理）

#### 部署架构
- **容器化**：Docker + Docker Compose
- **服务编排**：Kubernetes（可选，规模较大时）
- **负载均衡**：Nginx
- **CDN**：静态资源加速
- **OSS**：对象存储（图片、音频等）

---

## 三、功能需求详细分析

### 3.1 用户认证系统

#### 3.1.1 小程序端登录
**功能描述**：
- 微信授权登录（获取用户基本信息：昵称、头像）
- 微信授权获取手机号（用于账号绑定和找回）

**业务流程**：
1. 用户首次进入小程序，弹出授权提示
2. 用户同意授权，获取 openid、unionid
3. 后端创建/更新用户记录
4. 需要手机号时（如发布内容），触发手机号授权
5. 后端绑定手机号到用户账号

**关键技术点**：
- wx.login() + code换取openid
- wx.getUserProfile() 获取用户信息
- button open-type="getPhoneNumber" 获取手机号

#### 3.1.2 H5端登录
**功能描述**：
- 昵称 + 密码登录
- 手机号 + 验证码登录（可选）
- 找回密码功能

**业务流程**：
1. 用户输入昵称和密码
2. 后端验证账号密码
3. 返回 JWT Token
4. 前端存储 Token，后续请求携带

**关键技术点**：
- 密码加密存储（bcrypt）
- JWT Token 认证
- 刷新 Token 机制

#### 3.1.3 账号系统
**核心要素**：
- 唯一用户ID
- 昵称（可修改）
- 头像
- 手机号（绑定后不可轻易修改）
- 注册时间
- 最后登录时间
- 用户状态（正常、封禁）
- 用户等级/积分

---

### 3.2 首页 - 诗词推荐

#### 3.2.1 推荐内容
**展示形式**：
- 随机推荐一句诗词名句
- 或推荐一首完整诗词
- 或推荐一段词（词牌名）

**推荐策略**：
- 每日推荐：每天固定推荐一首
- 随机推荐：每次刷新随机展示
- 智能推荐：基于用户浏览、点赞、收藏历史
- 节日推荐：根据节日推荐相关主题诗词
- 热门推荐：根据点赞数、评论数推荐热门内容

**展示内容**：
- 诗词内容（部分或全部）
- 作者
- 朝代
- 背景图片/配色
- 互动数据（点赞数、评论数、收藏数）

#### 3.2.2 互动功能
**点赞**：
- 单个用户对同一内容只能点赞一次
- 点赞后可取消
- 实时更新点赞数

**收藏**：
- 收藏到个人收藏夹
- 可取消收藏
- 支持收藏分类（可选）

**评论**：
- 发表对诗词的感悟和见解
- 评论字数限制（如500字以内）
- 评论可以被点赞
- 评论可以被回复

**跳转详情**：
- 点击卡片任意区域进入诗词详情页

#### 3.2.3 刷新机制
- 下拉刷新：获取新的推荐内容
- 自动切换：定时自动切换推荐内容（可选）

---

### 3.3 诗词详情页

#### 3.3.1 内容展示
**诗词信息**：
- 诗词标题
- 诗词完整内容
- 作者姓名
- 朝代
- 诗词类型（如：五言绝句、七言律诗、词等）
- 创作背景（可选）
- 注释/翻译（可选）
- 赏析文章（可选）

**数据统计**：
- 阅读数（去重统计，同一用户只计一次）
- 点赞数
- 评论数
- 收藏数

**互动按钮**：
- 点赞按钮（已点赞/未点赞状态）
- 收藏按钮（已收藏/未收藏状态）
- 分享按钮（分享到微信、朋友圈、复制链接）

#### 3.3.2 评论区
**评论排序**：
- **最新**：按评论时间倒序排列
- **热评**：按点赞数排序（或综合点赞数和评论时间的算法）

**评论功能**：
- 发表评论
- 查看评论
- 点赞评论
- 回复评论（二级评论）
- 删除自己的评论
- 举报不良评论

**评论展示**：
- 用户头像、昵称
- 评论内容
- 评论时间
- 点赞数
- 回复列表（展开/收起）

#### 3.3.3 阅读统计
**统计规则**：
- 用户进入详情页即计为一次阅读
- 同一用户对同一诗词只计算一次阅读
- 使用 userId + 诗词ID 去重
- 未登录用户使用设备ID去重（可选）

---

### 3.4 诗词列表页

#### 3.4.1 列表展示
**展示内容**：
- 诗词部分内容（前几句或包含关键词的片段）
- 诗词标题
- 作者
- 朝代
- 阅读数
- 点赞数
- 评论数
- 缩略图/装饰图（可选）

**列表加载**：
- 分页加载（每页10-20条）
- 上拉加载更多
- 加载状态提示

#### 3.4.2 搜索功能
**搜索方式**：
- 关键词搜索（支持诗词内容、标题、作者）
- 搜索历史记录（本地存储）
- 热门搜索推荐

**搜索结果**：
- 高亮显示匹配的关键词
- 显示匹配内容的上下文
- 按相关度或时间排序

**搜索优化**：
- 搜索建议/自动补全
- 支持模糊搜索
- 支持拼音搜索（可选）

#### 3.4.3 筛选功能
**按朝代筛选**：
- 先秦
- 汉代
- 魏晋
- 南北朝
- 隋代
- 唐代
- 宋代
- 元代
- 明代
- 清代
- 近现代

**按类型筛选**：
- 诗（五言绝句、七言绝句、五言律诗、七言律诗、古体诗等）
- 词（不同词牌名）
- 曲
- 赋
- 文言文

**按诗人筛选**：
- 热门诗人列表
- 诗人搜索
- 按朝代分类诗人

**多条件组合**：
- 支持多个筛选条件同时生效
- 筛选条件可清除
- 显示当前筛选状态

#### 3.4.4 排序功能
- 最新发布
- 最热（综合点赞、评论、阅读）
- 阅读最多
- 点赞最多
- 评论最多

---

### 3.5 广场页面

#### 3.5.1 广场 Tab
**功能定位**：用户自由发布内容的社区空间

**内容类型**：
- 原创诗词
- 读后感/赏析
- 诗词配图
- 诗词相关话题讨论
- 传统文化分享

**发布功能**：
- 文字内容（字数限制，如3000字）
- 图片上传（最多9张）
- 话题标签
- 选择可见范围（公开/仅关注者可见）

**内容展示**：
- 瀑布流或列表形式
- 显示用户头像、昵称、发布时间
- 内容预览（超长内容折叠，点击展开）
- 图片展示（网格布局）
- 点赞数、评论数、收藏数

**互动功能**：
- 点赞
- 评论（支持二级评论）
- 收藏
- 分享
- 关注作者
- 举报

**内容推荐算法**：
- 最新发布
- 热门推荐（根据互动数据）
- 关注动态
- 推荐算法（基于用户兴趣）

#### 3.5.2 飞花令 Tab
**功能定位**：诗词接龙游戏，考验诗词储备

**游戏模式**：

**1. 系统匹配**
- 随机匹配在线玩家
- 匹配等级相近的玩家
- 快速开始游戏

**2. 玩家匹配**
- 好友对战
- 房间模式（创建房间，邀请好友）
- 公开房间（其他玩家可加入）

**游戏规则**：
- 指定一个关键字（如"春"、"月"、"花"等）
- 玩家轮流说出包含该关键字的诗句
- 规定时间内未作答或重复诗句则失败
- 可设置回合数或时间限制

**游戏设置**：
- 选择关键字
- 设置难度（常见字/生僻字）
- 设置回答时间（30秒/60秒等）
- 选择朝代范围（可选）

**游戏流程**：
1. 选择模式，进入匹配
2. 匹配成功，展示双方信息
3. 系统随机或玩家选择关键字
4. 游戏开始，轮流作答
5. 系统判断答案是否正确（是否包含关键字、是否为真实诗句、是否已使用过）
6. 判定胜负，展示游戏结果
7. 奖励积分/经验

**游戏记录**：
- 历史对战记录
- 胜率统计
- 使用过的诗句记录
- 排行榜

**技术要点**：
- WebSocket 实时通信
- 诗词库匹配验证
- 防作弊机制
- 断线重连

---

### 3.6 个人中心页

#### 3.6.1 用户信息展示
**基本信息**：
- 头像
- 昵称
- 用户ID/账号
- 个人简介
- 注册时间

**等级系统**：
- 当前等级（如：初学者、爱好者、学者、大师）
- 当前经验值
- 升级所需经验
- 等级权益说明

**统计数据**：
- 发布数量
- 获赞总数
- 粉丝数
- 关注数
- 访客数（最近访问）

#### 3.6.2 我的内容
**我的收藏**：
- 收藏的诗词
- 收藏的广场内容
- 分类管理（可选）
- 批量管理（删除、移动）

**我的关注**：
- 关注的用户列表
- 用户动态更新提醒
- 取消关注

**我的粉丝**：
- 粉丝列表
- 相互关注标识
- 快速回关

**我的评论**：
- 我发表的评论列表
- 按时间排序
- 跳转到原诗词/内容

**我的点赞**：
- 点赞过的诗词列表
- 点赞过的广场内容
- 点赞时间

**我的发布**：
- 在广场发布的内容
- 编辑/删除
- 查看互动数据

#### 3.6.3 站内消息
**消息类型**：
- **系统通知**：系统公告、活动通知
- **互动消息**：点赞、评论、收藏通知
- **关注消息**：新增粉丝、关注的人发布内容
- **私信**：用户之间私信（可选功能）
- **审核通知**：内容审核结果

**消息功能**：
- 未读消息提醒（红点）
- 消息列表（按时间倒序）
- 消息详情
- 标记已读
- 删除消息

#### 3.6.4 用户设置
**账号设置**：
- 修改昵称
- 修改头像
- 修改个人简介
- 绑定/解绑手机号
- 修改密码（H5端）
- 注销账号

**隐私设置**：
- 谁可以看我的主页
- 谁可以评论我的内容
- 是否接收消息通知
- 是否允许陌生人私信

**通用设置**：
- 语言设置
- 字体大小
- 夜间模式
- 清除缓存

**关于**：
- 版本号
- 用户协议
- 隐私政策
- 联系客服
- 意见反馈

---

### 3.7 管理端功能

#### 3.7.1 用户管理
- 用户列表（分页、搜索）
- 用户详情
- 用户状态管理（封禁、解封）
- 用户等级调整
- 用户数据统计

#### 3.7.2 内容管理
**诗词管理**：
- 诗词列表（增删改查）
- 批量导入诗词
- 诗词分类管理
- 诗词审核（用户提交的）
- 诗词推荐设置

**广场内容管理**：
- 内容列表
- 内容审核（待审核、已通过、已拒绝）
- 内容删除/隐藏
- 违规内容处理

**评论管理**：
- 评论列表
- 删除不良评论
- 封禁违规用户

#### 3.7.3 运营管理
**首页推荐**：
- 每日推荐设置
- 热门推荐配置
- 节日主题设置

**活动管理**：
- 创建活动
- 活动数据统计
- 活动推广

**标签/话题管理**：
- 热门话题设置
- 话题分类
- 话题推荐

#### 3.7.4 系统管理
**统计分析**：
- 用户增长曲线
- 活跃用户统计
- 内容增长统计
- 互动数据分析

**系统设置**：
- 敏感词过滤
- 上传限制设置
- 评论审核开关
- 系统参数配置

**权限管理**：
- 管理员账号管理
- 角色权限配置
- 操作日志

---

## 四、核心数据模型（概念设计）

### 4.1 用户相关

#### User（用户表）
```
- id: 用户唯一标识
- openid: 微信openid（小程序）
- unionid: 微信unionid
- username: 登录账号（H5）
- password: 登录密码（加密）
- nickname: 昵称
- avatar: 头像URL
- phone: 手机号
- gender: 性别
- intro: 个人简介
- level: 用户等级
- exp: 经验值
- status: 账号状态（正常、封禁）
- register_time: 注册时间
- last_login_time: 最后登录时间
```

#### UserFollow（关注关系表）
```
- id: 关系ID
- user_id: 关注者ID
- follow_user_id: 被关注者ID
- create_time: 关注时间
```

### 4.2 诗词相关

#### Poetry（诗词表）
```
- id: 诗词ID
- title: 标题
- content: 内容
- author_id: 作者ID（关联诗人表）
- dynasty: 朝代
- type: 类型（诗、词、曲等）
- tags: 标签
- translation: 翻译
- annotation: 注释
- appreciation: 赏析
- background: 创作背景
- read_count: 阅读数
- like_count: 点赞数
- comment_count: 评论数
- collect_count: 收藏数
- status: 状态（已发布、草稿、已删除）
- create_time: 创建时间
- update_time: 更新时间
```

#### Author（诗人表）
```
- id: 诗人ID
- name: 姓名
- dynasty: 朝代
- intro: 简介
- avatar: 头像
- birth_year: 出生年份
- death_year: 逝世年份
```

#### PoetryRead（阅读记录表）
```
- id: 记录ID
- user_id: 用户ID
- poetry_id: 诗词ID
- read_time: 阅读时间
- 唯一索引：(user_id, poetry_id)
```

### 4.3 互动相关

#### Like（点赞表）
```
- id: 点赞ID
- user_id: 用户ID
- target_type: 目标类型（诗词、广场内容、评论）
- target_id: 目标ID
- create_time: 点赞时间
- 唯一索引：(user_id, target_type, target_id)
```

#### Collect（收藏表）
```
- id: 收藏ID
- user_id: 用户ID
- target_type: 目标类型（诗词、广场内容）
- target_id: 目标ID
- category: 收藏分类（可选）
- create_time: 收藏时间
```

#### Comment（评论表）
```
- id: 评论ID
- user_id: 用户ID
- target_type: 目标类型（诗词、广场内容）
- target_id: 目标ID
- parent_id: 父评论ID（二级评论）
- content: 评论内容
- like_count: 点赞数
- reply_count: 回复数
- status: 状态（正常、已删除）
- create_time: 评论时间
```

### 4.4 广场相关

#### Post（广场内容表）
```
- id: 内容ID
- user_id: 用户ID
- content: 内容
- images: 图片URLs（JSON）
- tags: 标签
- type: 类型（原创、分享等）
- like_count: 点赞数
- comment_count: 评论数
- collect_count: 收藏数
- view_count: 浏览数
- status: 状态（待审核、已发布、已删除）
- create_time: 发布时间
- update_time: 更新时间
```

### 4.5 飞花令相关

#### GameRoom（游戏房间表）
```
- id: 房间ID
- room_type: 房间类型（系统匹配、玩家匹配）
- keyword: 关键字
- player1_id: 玩家1 ID
- player2_id: 玩家2 ID
- current_player: 当前回合玩家
- round: 当前回合数
- max_round: 最大回合数
- time_limit: 回答时间限制
- status: 状态（等待中、进行中、已结束）
- winner_id: 获胜者ID
- create_time: 创建时间
- start_time: 开始时间
- end_time: 结束时间
```

#### GameRecord（游戏记录表）
```
- id: 记录ID
- room_id: 房间ID
- user_id: 用户ID
- poetry_id: 诗句ID
- poetry_content: 诗句内容
- round: 回合数
- is_correct: 是否正确
- answer_time: 作答时间
- create_time: 创建时间
```

### 4.6 消息相关

#### Message（消息表）
```
- id: 消息ID
- user_id: 接收用户ID
- type: 消息类型（系统、互动、关注、私信）
- title: 标题
- content: 内容
- related_type: 关联类型
- related_id: 关联ID
- from_user_id: 发送者ID（私信）
- is_read: 是否已读
- create_time: 创建时间
```

---

## 五、非功能性需求

### 5.1 性能要求
- 页面加载时间 < 2秒
- 接口响应时间 < 500ms
- 支持并发用户数 ≥ 10000
- 搜索响应时间 < 1秒

### 5.2 安全要求
- 用户密码加密存储
- 接口鉴权（JWT Token）
- 防止SQL注入、XSS攻击
- 敏感信息加密传输（HTTPS）
- 防刷机制（限流、验证码）
- 内容审核（敏感词过滤）

### 5.3 可用性要求
- 系统可用性 ≥ 99.9%
- 数据备份机制
- 错误日志记录
- 异常监控告警

### 5.4 易用性要求
- 界面简洁美观
- 操作流程简单
- 加载状态提示
- 错误提示友好
- 支持新手引导

### 5.5 扩展性要求
- 模块化设计
- 接口标准化
- 支持横向扩展
- 支持多端扩展（如APP）

---

## 六、项目实施计划建议

### 6.1 第一阶段：基础功能（MVP）
**时间**：4-6周

**功能模块**：
1. 用户登录注册（小程序授权、H5账号密码）
2. 诗词列表展示
3. 诗词详情页
4. 基础搜索功能
5. 点赞、收藏功能
6. 个人中心（基础信息、收藏列表）

**交付物**：
- 可运行的小程序端
- 可运行的H5端
- 后端API服务
- 基础诗词数据

### 6.2 第二阶段：社交功能
**时间**：3-4周

**功能模块**：
1. 评论系统（一级、二级评论）
2. 广场功能（用户发布、查看）
3. 关注系统
4. 站内消息
5. 用户等级系统

### 6.3 第三阶段：高级功能
**时间**：4-5周

**功能模块**：
1. 飞花令游戏
2. 智能推荐算法
3. 高级搜索（多条件筛选）
4. 数据统计分析
5. 性能优化

### 6.4 第四阶段：管理端与运营
**时间**：3-4周

**功能模块**：
1. 管理后台开发
2. 内容审核系统
3. 数据统计报表
4. 运营工具
5. 系统监控

### 6.5 第五阶段：测试与上线
**时间**：2-3周

**任务**：
1. 功能测试
2. 性能测试
3. 安全测试
4. 用户体验测试
5. Bug修复
6. 部署上线

---

## 七、风险与挑战

### 7.1 技术风险
- **诗词数据获取**：需要大量高质量诗词数据
  - 解决方案：使用开源诗词数据库（如GitHub上的古诗词数据集）

- **搜索性能**：海量诗词数据的快速检索
  - 解决方案：使用Elasticsearch全文搜索引擎

- **实时通信**：飞花令游戏的实时对战
  - 解决方案：使用WebSocket技术

### 7.2 业务风险
- **内容审核**：用户发布的内容需要审核
  - 解决方案：敏感词过滤 + 人工审核 + 举报机制

- **用户增长**：如何吸引和留住用户
  - 解决方案：内容质量、社交互动、游戏化设计

- **版权问题**：诗词内容的版权
  - 解决方案：使用古代诗词（无版权问题），现代作品需获得授权

### 7.3 运营风险
- **服务器成本**：用户增长带来的成本压力
  - 解决方案：优化架构、使用CDN、合理的扩容策略

- **违规内容**：用户发布违规内容
  - 解决方案：完善的审核机制、用户举报、封禁机制

---

## 八、成功指标（KPI）

### 8.1 用户指标
- 注册用户数
- 日活跃用户（DAU）
- 月活跃用户（MAU）
- 用户留存率（次日、7日、30日）
- 用户平均使用时长

### 8.2 内容指标
- 诗词总量
- 用户发布内容数
- 内容互动率（点赞、评论、收藏）
- 内容质量评分

### 8.3 社交指标
- 用户关注数
- 评论数
- 分享次数
- 飞花令对局数

### 8.4 技术指标
- 接口响应时间
- 系统可用性
- 错误率
- 并发支持能力

---

## 九、总结

本诗词程序是一个集内容、社交、游戏于一体的综合性平台，具有以下特点：

**优势**：
1. **垂直领域**：专注诗词文化，目标用户明确
2. **多端支持**：小程序 + H5，覆盖更多用户
3. **社交互动**：评论、点赞、关注，增强用户粘性
4. **游戏化设计**：飞花令等游戏增加趣味性
5. **内容丰富**：海量诗词 + 用户原创内容

**核心竞争力**：
1. 优质的诗词内容库
2. 良好的用户体验
3. 活跃的社区氛围
4. 创新的互动玩法

**下一步工作**：
1. 确定技术栈
2. 数据库详细设计
3. API接口设计
4. UI/UX设计
5. 搭建开发环境
6. 开始编码实现
