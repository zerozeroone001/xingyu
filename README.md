# 诗词程序 - 项目文档总览

> 一个多端部署的诗词平台，包含微信小程序、H5网页、管理后台，支持AI诗词生成、智能推荐、社交互动等功能。

---

## 📚 文档导航

### 核心文档

| 文档 | 说明 | 状态 |
|------|------|------|
| [需求分析文档.md](./需求分析文档.md) | 详细的功能需求分析，包含9大功能模块 | ✅ 已完成 |
| **[第三方AI服务集成方案.md](./第三方AI服务集成方案.md)** | **AI功能实现方案（调用API）⭐推荐** | ✅ 已完成 |
| [项目目录结构.md](./项目目录结构.md) | 完整的项目目录规划 | ✅ 已完成 |
| [技术选型建议_Python版.md](./技术选型建议_Python版.md) | Python后端技术选型详解 | ✅ 已完成 |

### 参考文档

| 文档 | 说明 | 备注 |
|------|------|------|
| [AI模型集成方案.md](./AI模型集成方案.md) | 本地部署AI模型方案 | ⚠️ 参考文档，实际采用第三方API |
| [技术选型建议.md](./技术选型建议.md) | Node.js技术栈方案 | ⚠️ 备选方案 |

---

## 🎯 最终技术方案

### 技术架构

```
┌─────────────────────────────────────┐
│          前端层                      │
├─────────────────────────────────────┤
│  小程序+H5: uni-app (Vue 3)         │
│  管理端: Vue 3 + Element Plus       │
└─────────────────────────────────────┘
           ↓ HTTP/WebSocket
┌─────────────────────────────────────┐
│        后端层 (Python)               │
├─────────────────────────────────────┤
│  FastAPI + SQLAlchemy 2.0           │
│  Celery (异步任务)                  │
│  WebSocket (实时通信)               │
└─────────────────────────────────────┘
           ↓ API调用
┌─────────────────────────────────────┐
│       AI层 (第三方API) 🤖           │
├─────────────────────────────────────┤
│  通义千问 / 文心一言                │
│  - 诗词生成                         │
│  - 诗词分析                         │
│  - 智能问答                         │
└─────────────────────────────────────┘
           ↓ 数据存储
┌─────────────────────────────────────┐
│          数据层                      │
├─────────────────────────────────────┤
│  MySQL 8.0 (主数据库)               │
│  Redis 6+ (缓存、会话)              │
│  Elasticsearch 7+ (搜索引擎)        │
└─────────────────────────────────────┘
```

### 技术栈清单

#### 前端
- **用户端**：uni-app (Vue 3 + TypeScript)
  - 一套代码，同时支持微信小程序和H5
- **管理端**：Vue 3 + Element Plus + Vite
- **状态管理**：Pinia
- **HTTP客户端**：Axios

#### 后端
- **框架**：FastAPI (Python 3.11+)
  - 高性能异步框架
  - 自动生成API文档
  - 类型安全
- **ORM**：SQLAlchemy 2.0 (异步)
- **任务队列**：Celery + Redis
- **实时通信**：FastAPI WebSocket

#### AI服务 🤖
- **方式**：调用第三方API（无需本地部署）
- **服务商**：阿里云通义千问 或 百度文心一言
- **功能**：
  - AI诗词生成
  - 诗词分析（翻译、赏析）
  - 智能问答
  - 飞花令AI对手

#### 数据库
- **主数据库**：MySQL 8.0
- **缓存**：Redis 6+
- **搜索引擎**：Elasticsearch 7+

#### 云服务
- **服务器**：阿里云 / 腾讯云（2核4G即可）
- **对象存储**：阿里云OSS / 腾讯云COS
- **CDN**：阿里云CDN

---

## 📋 核心功能

### 用户端（小程序 + H5）

#### 1. 首页 - 诗词推荐 🏠
- 每日推荐一首诗词
- 支持点赞、收藏、评论
- 点击查看完整内容

#### 2. 诗词列表 📚
- 按朝代、类型、诗人筛选
- 关键词搜索
- 显示诗词摘要、阅读数、点赞数

#### 3. 诗词详情 📖
- 完整诗词内容
- 作者、朝代信息
- 翻译、注释、赏析（可调用AI生成）
- 评论区（最新/热评）
- 点赞、收藏功能

#### 4. 广场 🎪
- **广场Tab**：用户发布内容，社交互动
- **飞花令Tab**：
  - 系统匹配：随机匹配在线玩家
  - 玩家匹配：好友对战、房间模式
  - **AI对手**：与AI对战飞花令 🤖

#### 5. AI功能 🤖
- **AI诗词生成**：输入主题，AI创作诗词
- **诗词分析**：翻译、赏析、情感分析
- **智能问答**：诗词知识问答

#### 6. 个人中心 👤
- 用户信息、等级
- 收藏、关注、点赞
- 我的发布
- 站内消息
- 用户设置

### 管理端

- 用户管理
- 诗词管理（增删改查、批量导入）
- 内容审核（广场内容、评论）
- 数据统计
- 系统设置

---

## 💰 成本估算

### 服务器成本（月）

| 项目 | 配置 | 价格 |
|------|------|------|
| Web服务器 | 2核4G 5M带宽 | 100-150元 |
| MySQL | 1核2G（或自建） | 50元 |
| Redis | 256MB（或自建） | 30元 |
| OSS存储 | 10GB + 流量 | 20元 |
| **总计** | | **200-250元/月** |

### AI调用成本（月）

假设月活跃用户：1000人

| 功能 | 调用次数 | 单价 | 月成本 |
|------|---------|------|--------|
| 诗词生成 | 1000次 | 0.0003元 | 0.3元 |
| 诗词分析 | 5000次 | 0.0002元 | 1元 |
| 智能问答 | 2000次 | 0.0003元 | 0.6元 |
| **总计** | | | **约2元/月** |

**总成本**：**200-250元/月** （AI成本可忽略不计）

💡 **对比**：如果本地部署AI模型，需要GPU服务器，成本至少 **1200-2200元/月**

---

## 🚀 开发计划

### 阶段一：基础功能（4-6周）

**功能**：
- ✅ 用户登录注册（微信授权、账号密码）
- ✅ 诗词列表、详情
- ✅ 搜索（Elasticsearch关键词搜索）
- ✅ 评论、点赞、收藏
- ✅ 基础推荐（协同过滤）

**AI功能**：暂不接入

### 阶段二：AI功能（1-2周）🤖

**功能**：
- 🤖 AI诗词生成（通义千问API）
- 🤖 诗词分析（翻译、赏析）
- 🤖 飞花令AI对手

### 阶段三：社交功能（2-3周）

**功能**：
- ✅ 广场（用户发布、点赞、评论）
- ✅ 关注系统
- ✅ 站内消息

### 阶段四：游戏功能（2-3周）

**功能**：
- ✅ 飞花令（系统匹配、玩家匹配）
- ✅ WebSocket实时对战
- ✅ 游戏记录、排行榜

### 阶段五：管理端（2-3周）

**功能**：
- ✅ 管理后台开发
- ✅ 内容审核
- ✅ 数据统计

### 阶段六：测试与上线（1-2周）

**任务**：
- 功能测试
- 性能优化
- 部署上线

**总周期**：**12-18周**（3-4.5个月）

---

## 📦 依赖包

### 后端（Python）

```txt
# 核心框架
fastapi==0.104.1
uvicorn[standard]==0.24.0

# 数据库
sqlalchemy==2.0.23
aiomysql==0.2.0
alembic==1.12.1

# Redis
redis==5.0.1

# HTTP客户端（调用AI API）
httpx==0.25.1

# 认证
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4

# 任务队列
celery==5.3.4

# Elasticsearch
elasticsearch==8.11.0

# 工具
pydantic==2.5.0
pydantic-settings==2.1.0
python-dotenv==1.0.0

# ❌ 不需要以下大型AI依赖：
# torch (5GB+)
# transformers (1GB+)
# 总依赖大小：~100MB（vs 本地AI方案 5GB+）
```

### 前端（Vue）

```json
{
  "dependencies": {
    "vue": "^3.3.0",
    "@dcloudio/uni-app": "^3.0.0",
    "pinia": "^2.1.0",
    "axios": "^1.4.0"
  }
}
```

---

## 🔑 环境配置

### 后端 .env

```env
# 服务配置
APP_NAME=诗词平台
DEBUG=false
PORT=8000

# 数据库
DATABASE_URL=mysql+aiomysql://user:pass@localhost:3306/poetry_db

# Redis
REDIS_URL=redis://localhost:6379/0

# JWT
JWT_SECRET=your-secret-key
JWT_EXPIRES_IN=7d

# 微信小程序
WECHAT_APPID=your-appid
WECHAT_SECRET=your-secret

# AI服务（通义千问）
AI_PROVIDER=tongyi
TONGYI_API_KEY=sk-xxxxxxxxx
TONGYI_MODEL=qwen-turbo

# Elasticsearch
ES_NODE=http://localhost:9200
```

---

## 📖 开发指南

### 环境搭建

```bash
# 1. 安装Python 3.11+
python --version  # Python 3.11+

# 2. 创建虚拟环境
python -m venv venv
source venv/bin/activate  # Linux/Mac
# venv\Scripts\activate  # Windows

# 3. 安装依赖
pip install -r requirements.txt

# 4. 配置环境变量
cp .env.example .env
# 编辑.env，填入配置

# 5. 初始化数据库
alembic upgrade head

# 6. 导入诗词数据
python scripts/import_poetry.py

# 7. 启动服务
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### API文档

启动服务后访问：
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

---

## 🌟 核心亮点

### 1. 多端统一 📱
- uni-app一套代码，同时支持小程序和H5
- 降低开发成本，提高开发效率

### 2. AI赋能 🤖
- **无需本地部署**，调用第三方API
- AI诗词生成：用户可以创作专属诗词
- 诗词分析：自动翻译、赏析
- 飞花令AI对手：提升游戏体验
- **成本极低**：AI调用费用约2元/月

### 3. 社交互动 🎪
- 广场功能：用户发布、评论、点赞
- 关注系统：关注感兴趣的用户
- 飞花令游戏：实时对战

### 4. 智能推荐 🎯
- 协同过滤：基于用户行为推荐
- 个性化推荐：根据兴趣推荐

### 5. 成本低廉 💰
- 服务器成本：200-250元/月（普通服务器）
- AI调用成本：约2元/月（几乎可忽略）
- 适合个人/小团队开发

### 6. 技术先进 ⚡
- FastAPI高性能异步框架
- 自动生成API文档
- 类型安全，减少bug

---

## 🎯 优势对比

### 第三方API vs 本地部署

| 对比项 | 第三方API ✅ | 本地部署 |
|-------|-----------|---------|
| **开发成本** | 低（调用API即可） | 高（需AI专业知识） |
| **服务器成本** | 200元/月 | 1200+元/月（需GPU） |
| **维护成本** | 低（厂商负责） | 高（模型更新） |
| **技术门槛** | 低 | 高 |
| **AI质量** | 优秀（大厂模型） | 需自己训练 |
| **扩展性** | 按需扩展 | 受限于服务器 |
| **依赖大小** | ~100MB | ~5GB+ |

**结论**：对于中小型项目，**第三方API方案性价比更高**！

---

## 📞 下一步行动

1. **申请API密钥**
   - 注册阿里云账号
   - 开通通义千问服务
   - 获取API Key

2. **搭建开发环境**
   - 安装Python 3.11+
   - 安装MySQL、Redis
   - 配置环境变量

3. **导入诗词数据**
   - 从GitHub下载诗词数据集
   - 导入到数据库

4. **开始开发**
   - 实现基础功能（用户、诗词）
   - 接入AI功能
   - 前端开发

5. **测试部署**
   - 本地测试
   - 部署到云服务器
   - 小程序提交审核

---

## 📄 许可证

MIT License

---

**让诗词文化在AI时代焕发新生！** 🎉📚🤖
